<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulado ENEM 2023</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Vari√°veis de Cores para facilitar a troca */
        :root {
            --bg-body: #f0f2f5;
            --bg-card: #ffffff;
            --text-main: #212529;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
            --bg-context: #ffffff;
        }

        [data-theme="dark"] {
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #b0b0b0;
            --border-color: #333333;
            --bg-context: #2d2d2d;
        }

        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Segoe UI', sans-serif; transition: 0.3s; }
        .card { background-color: var(--bg-card); border-radius: 15px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.1); color: var(--text-main); }
        
        .option-btn { 
            text-align: left; margin-bottom: 12px; padding: 15px; border-radius: 10px; 
            transition: 0.3s; width: 100%; border: 1px solid var(--border-color); 
            background: var(--bg-card); color: var(--text-main); 
        }
        .option-btn:hover:not([disabled]) { background-color: rgba(13, 110, 253, 0.1); border-color: #0d6efd; }
        
        .correct { background-color: #198754 !important; border-color: #198754 !important; color: white !important; font-weight: bold; }
        .wrong { background-color: #dc3545 !important; border-color: #dc3545 !important; color: white !important; }
        
        #context-text { background-color: var(--bg-context); white-space: pre-wrap; font-size: 0.95rem; line-height: 1.6; border: 1px solid var(--border-color); }
        .sticky-score { position: sticky; top: 10px; z-index: 100; }
        .theme-toggle { cursor: pointer; font-size: 1.2rem; border: none; background: none; }
    </style>
</head>
<body class="py-4">
    <div class="container">
        <div class="row justify-content-center mb-4 sticky-score">
            <div class="col-md-8">
                <div class="card p-3 d-flex flex-row justify-content-between align-items-center">
                    <div class="d-flex align-items-center flex-grow-1">
                        <button class="theme-toggle me-3" onclick="toggleTheme()" id="theme-icon">üåô</button>
                        <select id="discipline-filter" class="form-select w-75" onchange="filterAndReset()">
                            <option value="all">Todas as Mat√©rias</option>
                        </select>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-primary">Acertos: <span id="score">0</span></span>
                        <span class="badge bg-secondary"><span id="current-pos">0</span>/<span id="total-filtered">0</span></span>
                        <button class="btn btn-sm btn-outline-danger ms-1" onclick="clearProgress()">üßπ</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-8">
                <div id="quiz-container" class="card p-4">
                    <div id="loading" class="text-center">Carregando simulado...</div>
                    <div id="question-content" style="display:none;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span id="q-discipline" class="badge bg-info text-dark"></span>
                            <span id="q-index" style="color: var(--text-muted); font-size: 0.8rem;"></span>
                        </div>
                        <h4 id="q-title" class="mb-3"></h4>
                        <div id="context-text" class="p-3 rounded mb-3"></div>
                        <p id="introduction" class="fw-bold"></p>
                        <div id="options" class="d-grid"></div>
                        <div id="feedback" class="mt-4 p-3 rounded alert" style="display:none;"></div>
                        <div class="d-flex gap-2 mt-4">
                            <button id="prev-btn" class="btn btn-outline-secondary flex-fill" onclick="changeQuestion(-1)">Anterior</button>
                            <button id="next-btn" class="btn btn-primary flex-fill" onclick="changeQuestion(1)">Pr√≥xima</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allQuestions = [];
        let filteredQuestions = [];
        let currentIndex = parseInt(localStorage.getItem('enem_last_index')) || 0;
        let score = parseInt(localStorage.getItem('enem_score')) || 0;
        let answeredQuestions = JSON.parse(localStorage.getItem('enem_answered')) || [];

        // L√≥gica de Tema
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('enem_theme', newTheme);
            document.getElementById('theme-icon').innerText = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Carregar tema salvo
        const savedTheme = localStorage.getItem('enem_theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('theme-icon').innerText = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        });

        fetch('enem_2023_final.json')
            .then(response => response.json())
            .then(data => {
                allQuestions = data.sort((a, b) => (a.index || 0) - (b.index || 0));
                const disciplines = [...new Set(allQuestions.map(q => q.discipline))];
                const select = document.getElementById('discipline-filter');
                disciplines.forEach(d => {
                    const opt = document.createElement('option');
                    opt.value = d;
                    opt.innerText = d.charAt(0).toUpperCase() + d.slice(1);
                    select.appendChild(opt);
                });

                const savedFilter = localStorage.getItem('enem_filter') || 'all';
                select.value = savedFilter;

                document.getElementById('loading').style.display = 'none';
                document.getElementById('question-content').style.display = 'block';
                filterAndReset(false);
            });

        function filterAndReset(resetIndex = true) {
            const filterVal = document.getElementById('discipline-filter').value;
            localStorage.setItem('enem_filter', filterVal);
            filteredQuestions = (filterVal === 'all') ? allQuestions : allQuestions.filter(q => q.discipline === filterVal);
            if(resetIndex) currentIndex = 0;
            if(currentIndex >= filteredQuestions.length) currentIndex = 0;
            document.getElementById('total-filtered').innerText = filteredQuestions.length;
            document.getElementById('score').innerText = score;
            renderQuestion();
        }

        function renderQuestion() {
            const q = filteredQuestions[currentIndex];
            if (!q) return;
            localStorage.setItem('enem_last_index', currentIndex);
            document.getElementById('current-pos').innerText = currentIndex + 1;
            document.getElementById('q-discipline').innerText = q.discipline.toUpperCase();
            document.getElementById('q-index').innerText = `Item #${q.index}`;
            document.getElementById('q-title').innerText = q.title;
            document.getElementById('context-text').innerText = q.context || "";
            document.getElementById('introduction').innerText = q.alternativesIntroduction;
            
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';
            document.getElementById('feedback').style.display = 'none';

            q.alternatives.forEach(alt => {
                const btn = document.createElement('button');
                btn.className = 'btn option-btn';
                btn.innerHTML = `<strong>${alt.letter})</strong> ${alt.text}`;
                btn.onclick = () => checkAnswer(alt.letter, btn);
                optionsDiv.appendChild(btn);
            });
            document.getElementById('prev-btn').disabled = (currentIndex === 0);
            document.getElementById('next-btn').disabled = (currentIndex === filteredQuestions.length - 1);
        }

        function checkAnswer(letter, clickedBtn) {
            const q = filteredQuestions[currentIndex];
            const correct = q.correctAlternative;
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.innerText.trim().startsWith(correct + ")")) btn.classList.add('correct');
            });
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'block';
            if (letter === correct) {
                if (!answeredQuestions.includes(q.index)) {
                    score++;
                    answeredQuestions.push(q.index);
                    localStorage.setItem('enem_score', score);
                    localStorage.setItem('enem_answered', JSON.stringify(answeredQuestions));
                }
                feedback.className = 'mt-4 p-3 rounded alert alert-success text-center';
                feedback.innerHTML = "‚ú® <strong>Correto!</strong>";
            } else {
                clickedBtn.classList.add('wrong');
                feedback.className = 'mt-4 p-3 rounded alert alert-danger text-center';
                feedback.innerHTML = `‚ùå <strong>Incorreto.</strong> A correta √© <strong>${correct}</strong>.`;
            }
            document.getElementById('score').innerText = score;
        }

        function changeQuestion(step) {
            currentIndex += step;
            renderQuestion();
        }

        function clearProgress() {
            if(confirm("Zerar todo o progresso?")) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>
